#!/usr/bin/env bash
set -eu

options=""
opts_regex="^--.+=.+$"

status=0
for arg in "$@"; do
	# Check if the argument is a puppet validation option or a file
	# The extra arguments always come first, so this will work fine
	if [[ "$arg" =~ $opts_regex ]]; then
		options="$options $arg"
	else
		output=$(puppet parser validate $options -- "$arg" 2>&1) || {
			echo -e "\033[31m\033[1m$arg: failed Puppet validation\033[0m"
			echo "$output"
			status=1
		}
	fi
done

exit "$status"
